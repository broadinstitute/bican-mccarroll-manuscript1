% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/de_age_sex_plots.R
\name{plot_kmeans_heatmap_with_cluster_labels}
\alias{plot_kmeans_heatmap_with_cluster_labels}
\title{Plot k-means clustered heatmap of log fold-changes
(originally plot_k_means_heatmap)}
\usage{
plot_kmeans_heatmap_with_cluster_labels(
  k_means_mat,
  lfc_mat,
  scaling_factor,
  k = 19,
  cluster_level_order = c(2, 10, 6, 3, 5, 14, 9, 13, 4, 1, 15, 19, 18, 7, 17, 8, 11, 12),
  allow_drop_clusters = TRUE
)
}
\arguments{
\item{k_means_mat}{Numeric matrix used for clustering.
Rows represent genes (or other units being clustered). Rownames must be
non-NULL and must correspond to gene identifiers. Typically this matrix is
a scaled (e.g., z-scored) version of `lfc_mat`, since k-means is
scale-sensitive.}

\item{lfc_mat}{Numeric matrix of log fold-changes used for visualization.
Rows represent genes and must include all genes present in `k_means_mat`
(at least those that remain after optional cluster dropping/releveling).
Columns typically represent cell types or cell_type-region combinations.}

\item{scaling_factor}{Numeric multiplier applied to `lfc_mat` prior to
plotting. This is used purely for visualization scaling and does not
affect clustering.}

\item{k}{Integer number of clusters (centers) for k-means.}

\item{cluster_level_order}{Optional integer vector defining the desired
ordering of k-means cluster labels. If NULL, cluster labels are used as
returned by k-means (no reordering and no cluster dropping). If non-NULL,
clusters not present in this vector will be dropped unless
`allow_drop_clusters = FALSE`.}

\item{allow_drop_clusters}{Logical; if FALSE, stop when `cluster_level_order`
would drop any cluster labels present in the k-means solution.}
}
\value{
A named integer vector of cluster assignments for genes, where names
  correspond to gene identifiers (after any optional dropping implied by
  `cluster_level_order`).
}
\description{
Performs k-means clustering on a gene-by-feature matrix and visualizes
the corresponding log fold-change matrix as a heatmap, ordered by cluster.
}
\details{
- Euclidean k-means clustering is performed with `stats::kmeans()` using
  `centers = k`, `nstart = 200`, and `iter.max = 20`.
- If `cluster_level_order` is provided, cluster labels are reordered
  according to that order; optionally, clusters not included may be dropped.
- The heatmap is generated using `pheatmap::pheatmap()` without column or row
  clustering. Columns are shown in the existing order of `lfc_mat`.
- Vertical separators between clusters are implemented by inserting
  explicit `NA` columns into the plotted matrix. These columns are rendered
  as solid black bars via `na_col = "black"`. This approach avoids fragile
  grid coordinate overlays and ensures that separators scale correctly and
  remain device-independent, since they are part of the matrix itself rather
  than graphical annotations layered on top.
}
