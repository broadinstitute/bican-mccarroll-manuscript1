% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/load_data_differential_expression.R
\name{make_joint_inputs}
\alias{make_joint_inputs}
\title{Build Bhat/Shat/Tstat/FDR matrices from a long DE results data frame}
\usage{
make_joint_inputs(
  df,
  coef_col = "logFC",
  t_col = "t",
  p_col = "P.Value",
  fdr_col = "adj.P.Val",
  gene_mode = c("union", "intersect"),
  big_se = 1e+06,
  fill_missing_fdr = NA_real_
)
}
\arguments{
\item{df}{Data frame in long format. Must contain columns \code{gene},
\code{cell_type}, \code{interaction}, and \code{contrast}, plus the columns
specified by \code{coef_col}, \code{t_col}, \code{p_col}, and \code{fdr_col}.
Each \code{(gene, condition)} combination must appear at most once.}

\item{coef_col}{Character scalar. Column name for the effect size (beta),
for example \code{"logFC"}. Default \code{"logFC"}.}

\item{t_col}{Character scalar. Column name for the t-statistic, for example
\code{"t"}. Default \code{"t"}.}

\item{p_col}{Character scalar. Column name for the p-value, for example
\code{"P.Value"}. Default \code{"P.Value"}.}

\item{fdr_col}{Character scalar. Column name for the FDR or q-value, for example
\code{"adj.P.Val"}. Default \code{"adj.P.Val"}.}

\item{gene_mode}{One of \code{c("union", "intersect")}. Use \code{"union"} to
include all genes observed in any condition (missing entries are replaced with
\code{beta = 0} and \code{SE = big_se}). Use \code{"intersect"} to keep only
genes present in every condition. Default \code{"union"}.}

\item{big_se}{Numeric scalar. Standard error to use when filling missing or
invalid entries. A very large value ensures such entries contribute ~0
information to mash. Default \code{1e6}.}

\item{fill_missing_fdr}{Numeric scalar used to fill missing FDR entries in
the returned \code{FDR} matrix (for plotting or logic only; not used by mash).
Default \code{NA_real_}.}
}
\value{
A list with components:
\describe{
  \item{\code{Bhat}}{Numeric matrix \code{[genes x conditions]} of betas.}
  \item{\code{Shat}}{Numeric matrix \code{[genes x conditions]} of standard errors
    (\code{abs(beta / t)}).}
  \item{\code{Tstat}}{Numeric matrix \code{[genes x conditions]} of t-statistics.}
  \item{\code{P_val}}{Numeric matrix \code{[genes x conditions]} of p-values.}
  \item{\code{FDR}}{Numeric matrix \code{[genes x conditions]} of FDR values.}
  \item{\code{missing_mask}}{Logical matrix \code{[genes x conditions]} indicating
    entries that were missing or invalid and replaced by \code{beta = 0},
    \code{SE = big_se}, \code{t = 0}.}
}
}
\description{
Construct rectangular matrices suitable for \code{mashr} or clustering from a
single "long" differential expression (DE) result data frame. The input must
contain one row per \code{gene} and condition, where the condition is defined
by \code{cell_type} and (optionally) \code{interaction}.

The input is assumed to be pre-filtered to a single contrast (for example,
all rows correspond to \code{contrast == "age"}). This function enforces that
exactly one unique \code{contrast} value is present, and then drops contrast
from the matrix column names.

For each condition, the function reads a coefficient column (for example,
\code{logFC}), a t-statistic column (for example, \code{t}), a p-value column,
and an FDR column. Standard errors are computed as \code{Shat = abs(beta / t)}
(so \code{t = beta / se} as in limma).
}
\details{
Conditions (matrix columns) are defined as:
\describe{
  \item{No interaction}{If \code{interaction} is entirely \code{NA}, columns are
    named by \code{cell_type}.}
  \item{With interaction}{If \code{interaction} is entirely non-\code{NA}, columns
    are named by \code{paste(cell_type, interaction, sep = "__")}.}
}
Mixed \code{NA}/non-\code{NA} values in \code{interaction} are treated as an error.

With \code{gene_mode = "union"}, rectangular matrices are formed by inserting
neutral placeholders for missing entries (\code{beta = 0}, \code{SE = big_se}).
With \code{gene_mode = "intersect"}, only genes present in every condition are
retained (pathological entries such as \code{t = 0} are still treated as missing
and assigned \code{SE = big_se}).
}
