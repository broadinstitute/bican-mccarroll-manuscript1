% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/select_marker_genes.R
\name{find_marker_genes}
\alias{find_marker_genes}
\title{Identify marker genes for a target annotation using donor-level comparisons}
\usage{
find_marker_genes(
  dge,
  targetAnnotation,
  annotation_column = "cell_type",
  high_expression_threshold = 10,
  fold_change = 10,
  method = c("one_vs_all", "target_vs_outgroup")
)
}
\arguments{
\item{dge}{A donor-collapsed \code{edgeR::DGEList} with one column per
donor/annotation combination. The \code{samples} slot must contain
columns for \code{donor} and \code{annotation_column}.}

\item{targetAnnotation}{A single annotation value identifying the target
group.}

\item{annotation_column}{Character scalar giving the column in
\code{dge$samples} that defines annotation labels. Default is
\code{"cell_type"}.}

\item{high_expression_threshold}{Minimum CPM required in the target group
(per donor) to count as expressed. Default is 10.}

\item{fold_change}{Minimum fold-change (target / comparator) required per
donor to count as passing. Default is 10.}

\item{method}{Character scalar specifying the comparison strategy. Must be
one of \code{"one_vs_all"} or \code{"target_vs_outgroup"}.}
}
\value{
A data.frame with one row per gene containing:
  \itemize{
    \item \code{gene}: Gene identifier.
    \item \code{annotation_column}: Name of the annotation column used.
    \item \code{target_annotation}: The target annotation value.
    \item \code{closest_annotation}: The most challenging comparator
      (for \code{"one_vs_all"}) or \code{"outgroup"} (for
      \code{"target_vs_outgroup"}).
    \item \code{median_cpm_target}: Median CPM across donors in the target
      group.
    \item \code{median_fold_change_across_donors}: Median fold-change across
      donors.
    \item \code{n_donors_expr}: Number of donors with target CPM above the
      expression threshold.
    \item \code{n_donors_fc_pass}: Number of donors exceeding the
      fold-change threshold.
    \item \code{n_donors_pass}: Number of donors satisfying both criteria.
    \item \code{n_donors_fail}: Number of donors failing one or both
      criteria.
  }
}
\description{
This function identifies genes that robustly distinguish a specified
`targetAnnotation` from other annotation values in a donor-collapsed
`edgeR::DGEList`. Expression is evaluated per donor using CPM, and genes are
ranked based on the number of donors that satisfy both a minimum expression
threshold in the target group and a minimum fold-change relative to a
comparator group.
}
\details{
Two comparison strategies are supported via the `method` argument:

\itemize{
  \item \strong{`"one_vs_all"`}: For each non-target annotation value, the
  target group is compared pairwise against that annotation within donors.
  For each gene, the "worst" comparison (the one with the greatest number of
  failing donors, breaking ties by lowest median fold-change) is selected.
  This emphasizes genes that remain well separated even from their closest
  competing annotation.

  \item \strong{`"target_vs_outgroup"`}: For each donor, raw counts from all
  non-target annotations are summed to form a single aggregated outgroup.
  A temporary DGEList is constructed with per-donor ingroup and outgroup
  counts, CPM is recomputed, and a single comparison (ingroup vs aggregated
  outgroup) is performed. This corresponds to a conventional in-group versus
  pooled out-group marker analysis.
}

In both methods, genes are summarized by the median fold-change across
donors and the number of donors passing expression and fold-change
thresholds. Results are sorted by decreasing number of passing donors and
decreasing median fold-change.
}
