% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mashR.R
\name{fit_mash}
\alias{fit_mash}
\title{Fit mash with EM-estimated residual correlation}
\usage{
fit_mash(
  Bhat,
  Shat,
  npc = 5L,
  missing_mask = NULL,
  only_cannonical_matrixes = F,
  exclude_truncated_pca_matrix = F,
  strong_gene_fdr_threshold = 0.01,
  lfsr_null_threshold = 0.2
)
}
\arguments{
\item{Bhat}{Numeric matrix of effect estimates (genes Ã— cell types).}

\item{Shat}{Numeric matrix of standard errors (same shape as \code{Bhat}); finite and >0.}

\item{npc}{Integer. Number of PCs to seed data-driven covariances; capped at \code{ncol(Bhat)}. Default \code{5L}.}

\item{missing_mask}{Logical matrix indicating missing entries in \code{Bhat}/\code{Shat}; optional.}

\item{only_cannonical_matrixes}{Logical. If \code{TRUE}, use only canonical covariances. Default \code{FALSE}.}

\item{exclude_truncated_pca_matrix}{Logical. If \code{TRUE}, drop truncated PCA covariance from ED list. Default \code{FALSE}.}

\item{strong_gene_fdr_threshold}{Numeric. FDR threshold to define "strong" genes for learning covariances. Default \code{0.01}.}

\item{lfsr_null_threshold}{Numeric. lfsr threshold that all conditions must exceed to treat a gene as null when estimating \eqn{V}. Default \code{0.2}.}
}
\value{
A fitted \code{mash} object (use \code{mashr} accessors such as
  \code{get_pm}, \code{get_psd}, and \code{get_lfsr} for summaries).
}
\description{
Fits a \pkg{mashr} model to per-gene effects across cell types while
estimating the residual correlation matrix \eqn{V} (e.g., from overlapping
donors) via \code{mash_estimate_corr_em}. Data-driven covariance components
are learned from "strong" signals and combined with canonical covariances for
the final mash fit.
}
