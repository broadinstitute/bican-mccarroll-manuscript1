% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mashR.R
\name{fit_mash}
\alias{fit_mash}
\title{Fit mash with EM-estimated residual correlation}
\usage{
fit_mash(
  Bhat,
  Shat,
  FDR,
  npc = 5L,
  n_null_est = 5000L,
  missing_mask = NULL,
  add.mem.profile = TRUE,
  only_cannonical_matrixes = F
)
}
\arguments{
\item{Bhat}{Numeric matrix of effect estimates (genes x cell types).}

\item{Shat}{Numeric matrix of standard errors (same dimensions as \code{Bhat});
must be finite and strictly positive.}

\item{FDR}{Numeric matrix of FDR estimates (genes x cell types)}

\item{npc}{Integer. Number of principal components used to seed
data-driven covariances (capped at \code{ncol(Bhat)}). Default: \code{5L}.}

\item{n_null_est}{Integer. Number of rows randomly sampled to estimate the
residual correlation \eqn{V} via EM. Default: \code{5000L}.}
}
\value{
A fitted \code{mash} object (use \code{mashr} accessors such as
  \code{get_pm}, \code{get_psd}, and \code{get_lfsr} for summaries).
}
\description{
Fits a \pkg{mashr} model to per-gene effects across cell types while
estimating the residual correlation matrix \eqn{V} (e.g., from overlapping
donors) via \code{mash_estimate_corr_em}. Data-driven covariance components
are learned from "strong" signals and combined with canonical covariances for
the final mash fit.
}
