% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/donor_age_prediction.R
\name{plot_mc_donor_predictions}
\alias{plot_mc_donor_predictions}
\title{Plot donor-level Monte Carlo age predictions with optional bias curve overlay}
\usage{
plot_mc_donor_predictions(
  donor_predictions,
  gam_fit_df = NULL,
  y_var = "pred_mean",
  color_var = "resid_mean",
  legend_title = "Residuals",
  alpha_points = 0.8,
  errorbar_width = 0.1
)
}
\arguments{
\item{donor_predictions}{data.frame with one row per donor. Must contain
\code{age}, \code{pred_mean}. If \code{y_var = "pred_mean_corrected"}, must
contain \code{pred_mean_corrected}. If \code{resid_sd} is present, it is used
for error bars. Also expects \code{cell_type} and \code{region} (single
unique values) for the plot title.}

\item{gam_fit_df}{Optional data.frame with columns \code{age} and
\code{gam_pred}. Only used to overlay the bias curve when
\code{y_var = "pred_mean"}.}

\item{y_var}{Either \code{"pred_mean"} (default) or \code{"pred_mean_corrected"}.}

\item{color_var}{Column in \code{donor_predictions} to map to point color.
Defaults to \code{"resid_mean"}.}

\item{legend_title}{Legend title for the color scale. Defaults to \code{"Residuals"}.}

\item{alpha_points}{Alpha for points.}

\item{errorbar_width}{Width for \code{geom_errorbar()}.}
}
\value{
A ggplot object.
}
\description{
Plots donor chronological age (x) against either:
\itemize{
  \item \code{pred_mean}: donor mean out-of-fold prediction (default), or
  \item \code{pred_mean_corrected}: bias-corrected prediction (post hoc)
}
}
\details{
When \code{gam_fit_df} is provided and \code{y_var = "pred_mean"}, the bias
curve (evaluated on an age grid) is overlaid as a red line to visualize the
age-dependent regression-to-the-mean bias. The curve itself is not intended
for interpretation.

Error bars reflect Monte Carlo variability of out-of-fold predictions across
repeated splits (\code{resid_sd}) and remain valid after deterministic mean
shifts. Therefore, error bars are drawn when \code{resid_sd} is available for
both supported y-variables.
}
