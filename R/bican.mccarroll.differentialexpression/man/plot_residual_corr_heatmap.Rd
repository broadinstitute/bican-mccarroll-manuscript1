% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/donor_age_prediction_residuals.R
\name{plot_residual_corr_heatmap}
\alias{plot_residual_corr_heatmap}
\title{Plot residual correlation heatmap within a slice}
\usage{
plot_residual_corr_heatmap(
  model_predictions,
  mode = c("within_region", "within_cell_type"),
  cell_type = NULL,
  region = NULL,
  value_var = "resid_mean",
  title = NULL,
  annotate_cells = TRUE,
  row_fontsize = 9,
  col_fontsize = 9,
  cell_fontsize = 9
)
}
\arguments{
\item{model_predictions}{A data.frame or data.table of donor-level predictions.
Must contain columns `donor`, `cell_type`, `region`, and the column specified
by `value_var`.}

\item{mode}{Character scalar. Either `"within_region"` or `"within_cell_type"`.}

\item{cell_type}{Character scalar giving the cell type slice when
`mode = "within_cell_type"`.}

\item{region}{Character scalar giving the region slice when
`mode = "within_region"`.}

\item{value_var}{Character scalar giving the residual column to correlate
(e.g., `"resid_mean"` or `"resid_mean_corrected"`).}

\item{title}{Optional character scalar to use as the heatmap title. If `NULL`,
a default title derived from `mode` and the slice value is used.}

\item{annotate_cells}{Logical; if `TRUE`, annotate cells with correlation values.}

\item{row_fontsize}{Font size for row labels.}

\item{col_fontsize}{Font size for column labels.}

\item{cell_fontsize}{Font size for cell annotations.}
}
\value{
A list with components:
\describe{
  \item{heatmap}{A `ComplexHeatmap::Heatmap` object. Draw with `ComplexHeatmap::draw()`.}
  \item{row_order_names}{Character vector giving the clustered row order.}
  \item{column_order_names}{Character vector giving the clustered column order.}
}
}
\description{
Compute the pairwise Pearson correlation matrix of donor residuals across
groups (cell types within a region, or regions within a cell type) and render
the result as a clustered heatmap using `ComplexHeatmap`.
}
\details{
Correlations are computed with `stats::cor(..., use = "pairwise.complete.obs")`.
The heatmap is clustered on both axes using hierarchical clustering.


To render the returned heatmap:
\preformatted{
out <- plot_residual_corr_heatmap(...)
ComplexHeatmap::draw(out$heatmap, heatmap_legend_side = "right")
}
}
