% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/donor_age_prediction.R
\name{predict_age_by_celltype_region}
\alias{predict_age_by_celltype_region}
\title{Train donor age prediction models across cell types and regions and write results}
\usage{
predict_age_by_celltype_region(
  data_dir,
  data_name,
  result_dir,
  age_de_results_dir,
  outPDFFile = NULL,
  contig_yaml_file,
  reduced_gtf_file,
  donor_col = "donor",
  age_col = "age",
  seed = 42,
  fdr_threshold = 0.05,
  optimize_alpha = FALSE,
  alpha_fixed = 0.5,
  mc_repeats = 200,
  min_donors = 50
)
}
\arguments{
\item{data_dir}{Directory containing the serialized input object used by
\code{bican.mccarroll.differentialexpression::prepare_data_for_differential_expression()}.}

\item{data_name}{Name of the dataset object to load (passed through to
\code{prepare_data_for_differential_expression()}).}

\item{result_dir}{Output directory for text artifacts produced by
\code{\link{write_age_outputs_all}}. Must already exist.}

\item{age_de_results_dir}{Directory containing per-cell-type or per-(cell type, region)
age differential expression results used by \code{\link{get_age_de_results}} and
\code{\link{predict_age_celltype}}.}

\item{outPDFFile}{Optional path to a PDF file. If provided, QC plots generated during
processing are printed to this PDF; otherwise plots are printed to the active device.}

\item{contig_yaml_file}{Path to the contig-groups YAML file used by
\code{\link{filter_dge_to_autosomes}}.}

\item{reduced_gtf_file}{Path to the reduced GTF used by \code{\link{filter_dge_to_autosomes}}.}

\item{donor_col}{Column name in \code{dge$samples} identifying the donor. Default \code{"donor"}.}

\item{age_col}{Column name in \code{dge$samples} giving chronological age. Default \code{"age"}.}

\item{seed}{Integer random seed used for splitting/training inside \code{\link{predict_age_celltype}}.}

\item{fdr_threshold}{FDR cutoff used when filtering to age DE genes inside
\code{\link{predict_age_celltype}}. Default \code{0.05}.}

\item{optimize_alpha}{Logical; if \code{TRUE}, select elastic net \code{alpha} by grid search
(via \code{\link{train_enet_cv_optimize_alpha}}). If \code{FALSE}, use \code{alpha_fixed}.}

\item{alpha_fixed}{Numeric elastic net \code{alpha} used when \code{optimize_alpha = FALSE}
(\code{0} ridge, \code{1} lasso). Default \code{0.5}.}

\item{mc_repeats}{Integer; number of repeated stratified 80/20 splits used for the final
Monte Carlo residual summaries inside \code{\link{predict_age_celltype}}.}

\item{min_donors}{Minimum number of donors required to fit a model for a given cell type.}
}
\description{
Loads a donor-level RNA-seq dataset (as a \code{DGEList}), restricts to autosomal genes,
and then fits a donor age prediction model for each (cell type, region) combination.
Regions are discovered per cell type from \code{dge$samples$region}. For each
successfully fit combination, this function generates QC plots and writes concatenated
tab-delimited outputs (donor predictions, model coefficients, and metrics) across all
combinations.
}
\details{
Combinations may be skipped due to insufficient genes after filtering.


Output file basenames are derived from \code{outPDFFile} using \code{\link{get_output_basename}}.

Regions are discovered per cell type as:
\code{unique(dge$samples$region[dge$samples$cell_type == cellType])} (with \code{NA} removed).
Each (cell type, region) pair is fit by calling \code{\link{predict_age_celltype}} with
\code{region} set. The \code{region} value is propagated into outputs via
\code{\link{extract_age_outputs}}.
}
